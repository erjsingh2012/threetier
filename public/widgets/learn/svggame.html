<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Catch the Falling Stars — SVG Game</title>
  <style>
    :root{--bg:#0b1220;--card:#071426;--accent:#ffd166;--muted:#9fb3c8}
    html,body{height:100%;margin:0}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#061021,#082035);font-family:system-ui,Segoe UI,Roboto,Arial;color:#fff}
    .gamewrap{width:100%;max-width:420px;height:720px;background:linear-gradient(180deg,#07182a,#04121a);border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,0.6);overflow:hidden;position:relative}
    header{padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
    header .title{font-weight:600}
    .hud{display:flex;gap:10px;align-items:center}
    button{background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff;padding:6px 10px;border-radius:8px;cursor:pointer}
    #game{width:100%;height:calc(100% - 64px);display:block;background:transparent}
    .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
    .controls{position:absolute;left:12px;right:12px;bottom:12px;display:flex;justify-content:space-between;pointer-events:auto}
    .arrow{background:rgba(255,255,255,0.04);border-radius:10px;padding:12px}
    .center-ui{position:absolute;left:0;right:0;top:50%;transform:translateY(-50%);text-align:center;pointer-events:auto}
    .start-btn{background:var(--accent);color:#071426;border:none;padding:10px 16px;border-radius:12px;font-weight:700}
    .small{font-size:13px;color:var(--muted)}
    footer{padding:8px;text-align:center;font-size:12px;color:rgba(255,255,255,0.6)}
    @media (max-height:700px){.gamewrap{height:640px}}
  </style>
</head>
<body>
  <div class="gamewrap" role="application" aria-label="Catch the Falling Stars game">
    <header>
      <div class="title">Catch the Falling Stars</div>
      <div class="hud">
        <div id="score">Score: 0</div>
        <button id="restart">Restart</button>
      </div>
    </header>

    <!-- SVG game area -->
    <svg id="game" viewBox="0 0 360 600" preserveAspectRatio="xMidYMid meet" aria-label="game canvas">
      <defs>
        <g id="star">
          <polygon points="12,0 15,8 24,9 17,14 19,23 12,18 5,23 7,14 0,9 9,8" fill="url(#gold)" stroke="#fff" stroke-opacity="0.06" stroke-width="0.5"/>
        </g>
        <linearGradient id="gold" x1="0" x2="1">
          <stop offset="0%" stop-color="#ffd166"/>
          <stop offset="100%" stop-color="#ff9f1c"/>
        </linearGradient>
      </defs>

      <!-- background stars for depth -->
      <rect x="0" y="0" width="360" height="600" fill="transparent" />

      <!-- falling stars group -->
      <g id="stars"></g>

      <!-- basket -->
      <g id="basket" transform="translate(160,520)">
        <rect x="-40" y="0" width="80" height="20" rx="6" fill="#ffffff10"/>
        <path d="M-36 0 q36 -28 72 0" fill="#0b78d1" opacity="0.95" transform="translate(-36,0) scale(0.5,1)"/>
        <rect x="-34" y="-14" width="68" height="14" rx="6" fill="#0b78d1"/>
      </g>

      <!-- ground -->
      <rect x="0" y="580" width="360" height="20" fill="#061827"/>
    </svg>

    <div class="overlay">
      <div class="center-ui" id="startScreen">
        <h2>Catch as many stars as you can</h2>
        <p class="small">Move the basket with left/right arrows or touch controls. Stars fall faster over time.</p>
        <div style="height:12px"></div>
        <button class="start-btn" id="startBtn">Start Game</button>
      </div>
    </div>

    <!-- touch controls -->
    <div class="controls" aria-hidden="false">
      <div class="arrow" id="leftBtn">◀</div>
      <div class="arrow" id="rightBtn">▶</div>
    </div>

    <footer>Tip: Tap the left/right areas to move the basket on mobile</footer>
  </div>

  <script>
    // Game variables
    const svg = document.getElementById('game');
    const starsGroup = document.getElementById('stars');
    const basket = document.getElementById('basket');
    const startBtn = document.getElementById('startBtn');
    const startScreen = document.getElementById('startScreen');
    const scoreEl = document.getElementById('score');
    const restartBtn = document.getElementById('restart');
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');

    const VIEW_W = 360, VIEW_H = 600;

    let gameState = 'idle'; // idle, running, over
    let score = 0;
    let stars = [];
    let basketX = 160; // basket translate x
    let speedMultiplier = 1;
    let keys = {left:false,right:false};
    let lastSpawn = 0; 
    let spawnInterval = 900; // ms
    let lastTime = null;
    let rafId = null;

    function createStar(x, y, vy){
      const gid = document.createElementNS('http://www.w3.org/2000/svg','g');
      gid.setAttribute('transform', `translate(${x},${y}) scale(1.2)`);
      gid.innerHTML = '<use href="#star" x="-12" y="-12"></use>';
      starsGroup.appendChild(gid);
      return {el: gid, x, y, vy};
    }

    function startGame(){
      // reset
      gameState = 'running';
      score = 0; updateScore();
      stars.forEach(s=>s.el.remove()); stars = [];
      basketX = 160; setBasket();
      speedMultiplier = 1; spawnInterval = 900; lastSpawn = performance.now(); lastTime = null;
      startScreen.style.display = 'none';
      // start loop
      rafId = requestAnimationFrame(loop);
    }

    function endGame(){
      gameState = 'over';
      cancelAnimationFrame(rafId);
      startScreen.style.display = 'block';
      startBtn.textContent = 'Play Again';
    }

    function updateScore(){ scoreEl.textContent = 'Score: ' + score; }

    function spawnStar(now){
      const x = Math.random() * (VIEW_W - 40) + 20;
      const y = -20;
      const vy = 80 + Math.random()*60; // px per second
      stars.push(createStar(x,y,vy));
      lastSpawn = now;
    }

    function setBasket(){
      // clamp
      basketX = Math.max(20, Math.min(VIEW_W - 20 - 40, basketX));
      basket.setAttribute('transform', `translate(${basketX},520)`);
    }

    function loop(ts){
      if(gameState !== 'running') return;
      if(!lastTime) lastTime = ts;
      const dt = (ts - lastTime) / 1000; // seconds
      lastTime = ts;

      // inputs
      const moveSpeed = 220; // px per second
      if(keys.left) basketX -= moveSpeed * dt;
      if(keys.right) basketX += moveSpeed * dt;
      setBasket();

      // spawn logic
      if(ts - lastSpawn > spawnInterval){ spawnStar(ts); // gradually increase difficulty
        speedMultiplier += 0.03;
        spawnInterval = Math.max(300, spawnInterval - 20);
      }

      // update stars
      for(let i = stars.length -1; i >= 0; i--){
        const s = stars[i];
        s.y += s.vy * dt * speedMultiplier;
        s.el.setAttribute('transform', `translate(${s.x},${s.y}) scale(1.2)`);

        // collision with basket (simple bounding box)
        const bx = basketX; const by = 520; const bw = 80; const bh = 24;
        if(s.y > by - 8 && s.y < by + 12 && s.x > bx - 30 && s.x < bx + bw - 10){
          // caught
          score += 1; updateScore();
          s.el.remove(); stars.splice(i,1);
          continue;
        }

        // missed -> fall beyond bottom
        if(s.y > VIEW_H + 40){
          // penalty or end
          s.el.remove(); stars.splice(i,1);
          // end game after 3 misses? we'll do single life: end on miss
          endGame();
        }
      }

      rafId = requestAnimationFrame(loop);
    }

    // input handlers
    window.addEventListener('keydown', e=>{
      if(e.key === 'ArrowLeft') keys.left = true;
      if(e.key === 'ArrowRight') keys.right = true;
      if(e.key === ' ' && gameState !== 'running') startGame();
    });
    window.addEventListener('keyup', e=>{
      if(e.key === 'ArrowLeft') keys.left = false;
      if(e.key === 'ArrowRight') keys.right = false;
    });

    // touch buttons
    leftBtn.addEventListener('pointerdown', ()=>{ keys.left = true; });
    leftBtn.addEventListener('pointerup', ()=>{ keys.left = false; });
    rightBtn.addEventListener('pointerdown', ()=>{ keys.right = true; });
    rightBtn.addEventListener('pointerup', ()=>{ keys.right = false; });

    // drag on game area for mobile
    let dragging = false; let dragOffsetX = 0;
    svg.addEventListener('pointerdown', e=>{
      dragging = true;
      dragOffsetX = e.clientX;
    });
    window.addEventListener('pointermove', e=>{
      if(!dragging) return;
      // convert clientX to svg coords
      const rect = svg.getBoundingClientRect();
      const svgX = (e.clientX - rect.left) * (VIEW_W / rect.width);
      basketX = svgX - 40; setBasket();
    });
    window.addEventListener('pointerup', ()=>{ dragging = false; });

    // start / restart hooks
    startBtn.addEventListener('click', ()=>{ startGame(); });
    restartBtn.addEventListener('click', ()=>{ if(gameState === 'running'){ endGame(); } startGame(); });

    // initial basket position
    setBasket();
  </script>
</body>
</html>
